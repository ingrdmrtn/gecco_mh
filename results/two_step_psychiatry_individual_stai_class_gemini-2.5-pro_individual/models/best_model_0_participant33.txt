class ParticipantModel2(CognitiveModelBase):
    """
    HYPOTHESIS: This model suggests that anxiety induces behavioral perseveration, 
    or a "stickiness" to recent choices. Anxious individuals may be less flexible 
    and more likely to repeat an action, irrespective of its recent outcomes. This 
    is implemented as a bonus value added to the most recently chosen stage-1 action. 
    The magnitude of this stickiness bonus is directly scaled by the participant's 
    STAI score, such that higher anxiety leads to stronger perseveration.

    Parameter Bounds:
    -----------------
    alpha: [0, 1]      (Learning rate)
    beta: [0, 10]     (Decision stochasticity)
    kappa: [0, 5]      (Strength of the perseveration bonus)
    """

    def unpack_parameters(self, model_parameters: tuple) -> None:
        self.alpha, self.beta, self.kappa = model_parameters

    def init_model(self) -> None:
        # Initialize a perseverance bonus for each stage-1 action
        self.perseveration_bonus = np.zeros(self.n_choices)

    def policy_stage1(self) -> np.ndarray:
        """Compute stage-1 action probabilities including perseveration bonus."""
        # Add the perseveration bonus to the learned Q-values
        q_effective = self.q_stage1 + self.perseveration_bonus
        return self.softmax(q_effective, self.beta)

    def post_trial(self, action_1: int, state: int, action_2: int, reward: float) -> None:
        """Update the perseveration bonus for the next trial."""
        super().post_trial(action_1, state, action_2, reward)
        # Set bonus for the chosen action, scaled by anxiety
        self.perseveration_bonus[action_1] = self.kappa * self.stai
        # Reset bonus for the unchosen action
        self.perseveration_bonus[1 - action_1] = 0.0

cognitive_model2 = make_cognitive_model(ParticipantModel2)