class ParticipantModel3(CognitiveModelBase):
    """
    HYPOTHESIS: Anxiety promotes behavioral rigidity, making the participant more
    likely to repeat their previous first-stage choice, irrespective of the outcome.
    This is modeled as a perseverative bias or "stickiness" (`kappa`), where the value
    of the most recent choice is temporarily boosted. The magnitude of this boost
    is scaled by the participant's STAI score.

    Parameter Bounds:
    -----------------
    alpha: [0, 1]      (Learning rate)
    beta:  [0, 10]     (Inverse temperature for softmax)
    kappa: [0, 5]      (Perseveration/stickiness parameter)
    """

    def unpack_parameters(self, model_parameters: tuple) -> None:
        self.alpha, self.beta, self.kappa = model_parameters

    def policy_stage1(self) -> np.ndarray:
        """
        Computes stage-1 action probabilities with an anxiety-driven
        perseveration bonus.
        """
        q_sticky = self.q_stage1.copy()
        
        # On all trials after the first, add a bonus to the Q-value
        # of the action that was just taken.
        if self.last_action1 is not None:
            # The bonus is the product of the base stickiness parameter and the STAI score
            stickiness_bonus = self.kappa * self.stai
            q_sticky[self.last_action1] += stickiness_bonus
            
        return self.softmax(q_sticky, self.beta)

cognitive_model3 = make_cognitive_model(ParticipantModel3)