class ParticipantModel2(CognitiveModelBase):
    """
    Hypothesis: Anxiety modulates 'Post-Error' exploration (reaction to failure).
    
    This model hypothesizes that anxiety specifically affects behavior after a loss (0 reward).
    Anxious individuals might become more erratic (lower beta/higher noise) or more 
    rigid (higher beta) immediately following a negative outcome.
    
    If last_reward == 0:
        beta_eff = beta_base + (beta_loss_stai * stai)
    Else:
        beta_eff = beta_base

    Parameter Bounds:
    -----------------
    alpha: [0, 1]
    beta_base: [0, 10]
    beta_loss_stai: [-5, 5] # How STAI shifts beta after a loss
    """

    def unpack_parameters(self, model_parameters: tuple) -> None:
        self.alpha, self.beta_base, self.beta_loss_stai = model_parameters

    def get_effective_beta(self) -> float:
        """Calculate beta based on the previous trial's outcome."""
        beta_eff = self.beta_base
        # Check if a previous trial exists and resulted in a loss (0.0)
        if self.last_reward is not None and self.last_reward == 0.0:
            beta_eff += (self.beta_loss_stai * self.stai)
            # Ensure beta remains non-negative
            beta_eff = max(0.0, beta_eff)
        return beta_eff

    def policy_stage1(self) -> np.ndarray:
        beta = self.get_effective_beta()
        return self.softmax(self.q_stage1, beta)

    def policy_stage2(self, state: int) -> np.ndarray:
        beta = self.get_effective_beta()
        return self.softmax(self.q_stage2[state], beta)

cognitive_model2 = make_cognitive_model(ParticipantModel2)