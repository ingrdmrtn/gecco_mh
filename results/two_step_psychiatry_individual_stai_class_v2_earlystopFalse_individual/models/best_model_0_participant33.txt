class ParticipantModel2(CognitiveModelBase):
    """
    HYPOTHESIS: Anxiety-Driven Attentional Narrowing (Forgetting).
    
    This model hypothesizes that high anxiety consumes cognitive resources, leading 
    to "attentional narrowing." Participants focus intensely on their chosen path 
    but rapidly forget or discount the value of the option they *did not* choose.
    
    This is implemented as a decay applied to the unchosen Stage 1 option's Q-value 
    on each trial. The rate of decay is proportional to the STAI score. This can 
    lead to perseveration if the chosen option remains reasonably good, as the 
    alternative fades from memory.

    Parameter Bounds:
    -----------------
    alpha: [0, 1]           # Learning rate
    beta: [0, 10]           # Inverse temperature
    decay_rate: [0, 1]      # Decay rate for unchosen options, scaled by STAI
    """

    def unpack_parameters(self, model_parameters: tuple) -> None:
        self.alpha, self.beta, self.decay_rate = model_parameters

    def value_update(self, action_1: int, state: int, action_2: int, reward: float) -> None:
        # Standard update for the chosen path
        delta_2 = reward - self.q_stage2[state, action_2]
        self.q_stage2[state, action_2] += self.alpha * delta_2
        
        delta_1 = self.q_stage2[state, action_2] - self.q_stage1[action_1]
        self.q_stage1[action_1] += self.alpha * delta_1
        
        # Decay the unchosen Stage 1 option
        # Anxiety determines how much the unchosen option fades
        unchosen_action = 1 - action_1
        decay_factor = self.decay_rate * self.stai
        # Ensure decay factor doesn't exceed 1 (though bounds usually handle this)
        decay_factor = np.clip(decay_factor, 0, 1)
        
        self.q_stage1[unchosen_action] *= (1.0 - decay_factor)

cognitive_model2 = make_cognitive_model(ParticipantModel2)