class ParticipantModel1(CognitiveModelBase):
    """
    HYPOTHESIS: Anxiety increases stimulus generalization (value leakage).
    
    High anxiety individuals often struggle to discriminate between safe and 
    unsafe cues, generalizing learning from one context to another. 
    In this model, when the participant updates the value of a chosen option 
    (spaceship or alien), a fraction of that update 'leaks' to the unchosen option.
    This blurring of values is modulated by STAI.
    
    update_unchosen = alpha * prediction_error * (stai * leakage_param)
    
    Parameter Bounds:
    -----------------
    alpha: [0, 1]          # Learning rate
    beta: [0, 10]          # Inverse temperature
    leakage_param: [0, 1]  # Scaling factor for anxiety-driven generalization
    """

    def unpack_parameters(self, model_parameters: tuple) -> None:
        self.alpha, self.beta, self.leakage_param = model_parameters

    def value_update(self, action_1: int, state: int, action_2: int, reward: float) -> None:
        # Calculate leakage factor based on anxiety
        leakage = self.stai * self.leakage_param
        
        # --- Stage 2 Update (Aliens) ---
        # Standard update for chosen alien
        delta_2 = reward - self.q_stage2[state, action_2]
        self.q_stage2[state, action_2] += self.alpha * delta_2
        
        # Leaky update for unchosen alien in the same state
        unchosen_a2 = 1 - action_2
        self.q_stage2[state, unchosen_a2] += self.alpha * delta_2 * leakage
        
        # --- Stage 1 Update (Spaceships) ---
        # Standard update for chosen spaceship (Model-Free)
        delta_1 = self.q_stage2[state, action_2] - self.q_stage1[action_1]
        self.q_stage1[action_1] += self.alpha * delta_1
        
        # Leaky update for unchosen spaceship
        unchosen_a1 = 1 - action_1
        self.q_stage1[unchosen_a1] += self.alpha * delta_1 * leakage

cognitive_model1 = make_cognitive_model(ParticipantModel1)